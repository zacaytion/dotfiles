###########################################
### BEGIN  ################################
### Source: https://github.com/romanr/macos-disable-path_helper
###########################################
unsetopt GLOBAL_RCS

# File to store the last known CRC32 checksum for /etc/zprofile
STATE_FILE="$HOME/.local/state/zsh/_path_helper_disable_state"

# Path to the system zsh profile file that may contain path_helper
ZPROFILE_FILE="/etc/zprofile"


# Function to get CRC32 of /etc/zprofile
get_crc32() {
  crc32 "$ZPROFILE_FILE" 2>/dev/null
}

# Function to comment out the entire if...fi block containing path_helper in /etc/zprofile
comment_out_path_helper() {
  sudo sed -i.bak '/if \[ -x \/usr\/libexec\/path_helper \]; then/,/fi/ s/^/#/' "$ZPROFILE_FILE"
}

# Load stored CRC32
if [ -f "$STATE_FILE" ]; then
  . "$STATE_FILE"
fi

unsetopt GLOBAL_RCS

CURRENT_CRC32=$(get_crc32)

if [ -z "$ZPROFILE_CRC32" ]; then
  read "_reply?/etc/zprofile has not been checked. Would you like to check and comment out path_helper in /etc/zprofile? [y/N] "
  if [[ $_reply =~ ^[Yy]$ ]]; then
    comment_out_path_helper
    CURRENT_CRC32=$(get_crc32)
    echo "ZPROFILE_CRC32=$CURRENT_CRC32" > "$STATE_FILE"
    echo "/etc/zprofile has been updated. Reopen your shell to avoid issues with paths."
  fi
elif [ "$CURRENT_CRC32" != "$ZPROFILE_CRC32" ]; then
  read "_reply?/etc/zprofile has been changed. Would you like to comment out path_helper in /etc/zprofile? [y/N] "
  if [[ $_reply =~ ^[Yy]$ ]]; then
    comment_out_path_helper
    CURRENT_CRC32=$(get_crc32)
    echo "ZPROFILE_CRC32=$CURRENT_CRC32" > "$STATE_FILE"
    echo "/etc/zprofile has been updated. Reopen your shell to avoid issues with paths."
  fi
fi
###########################################
### END ###################################
### Source: https://github.com/romanr/macos-disable-path_helper
###########################################

export DISPLAY=:0
export LANG='en_US.UTF-8'
export LC_ALL='en_US.UTF-8'

export EDITOR='emacs -nw'
export VISUAL='emacsclient -nw'
export PAGER=less

export DOTFILES=$HOME/.dotfiles

# remove duplicat entries from $PATH
# zsh uses $path array along with $PATH
typeset -U PATH path
path=(
    /usr/local/bin
    /usr/bin
    /bin
    /usr/sbin
    /sbin
    /Library/Apple/usr/bin
    $path
    "/Applications/Little Snitch.app/Contents/MacOS"
)


###########################################
###### XDG Config ####################
export XDG_CONFIG_HOME=$HOME/.config
export XDG_STATE_HOME=$HOME/.local/state
export XDG_CACHE_HOME=$HOME/Library/Caches
export XDG_DATA_HOME=$HOME/.local/share
export XDG_DATA_DIRS=(
    "$HOME/Library/Application Support"
    '/Library/Application Support'
    /opt/homebrew/share
    /usr/local/share
    /usr/share
)
export XDG_CONFIG_DIRS=(
    "$HOME/Library/Application Support"
    '/Library/Application Support'
    /etc/xdg
)

###########################################
###### Homebrew Config ####################
export HOMEBREW_CACHE=$XDG_CACHE_HOME/Homebrew
export HOMEBREW_LOGS=$HOMEBREW_CACHE/Logs
export HOMEBREW_CASK_OPTS=--require-sha
export HOMEBREW_DISPLAY_INSTALL_TIMES=1
export HOMEBREW_NO_ANALYTICS=1
export HOMEBREW_NO_AUTO_UPDATE=1
export HOMEBREW_FORCE_BREWED_CURL=1
export HOMEBREW_FORCE_BREWED_GIT=1
export HOMEBREW_FORCE_VENDOR_RUBY=1
export HOMEBREW_NO_ENV_HINTS=1

path=(
    /opt/homebrew/bin
    /opt/homebrew/sbin
    /opt/homebrew/opt/mise/bin
    /opt/homebrew/opt/git/bin
    /opt/podman/bin
    $path
)

###########################################
###### Less Config ########################
export LESS='-g -i -M -R -S -w -X -z-4'
export LESSHISTFILE=$XDG_STATE_HOME/less_hst
export LESSOPEN="|/opt/homebrew/bin/lesspipe.sh %s"

###########################################
###### Emacs Config #######################
export EMACSDIR=$HOME/.emacs.d
export DOOMDIR=$XDG_CONFIG_HOME/doom.d

path=(
    $EMACSDIR/bin
    $path
)

###########################################
###### Mise Config ########################
export MISE_CONFIG_DIR=$XDG_CONFIG_HOME/mise
export MISE_CACHE_DIR=$XDG_CACHE_HOME/mise
export MISE_STATE_DIR=$XDG_STATE_HOME/mise
export MISE_DATA_DIR=$XDG_DATA_HOME/mise
export MISE_FISH_AUTO_ACTIVATE=1
export MISE_NODE_DEFAULT_PACKAGES_FILE=$XDG_CONFIG_HOME/mise/default-packages/npm

###########################################
###### Node Config ########################
export NODE_REPL_HISTORY=$XDG_DATA_HOME/node_repl_hst
export NPM_CONFIG_USERCONFIG=$XDG_CONFIG_HOME/npm/npmrc

###########################################
###### Rust Config ########################
export RUSTUP_HOME=$XDG_DATA_HOME/rustup
export CARGO_HOME=$XDG_DATA_HOME/cargo

###########################################
###### Go Config ##########################
export GOPATH=$XDG_DATA_HOME/go
export GOCACHE=$XDG_CACHE_HOME/go
export GOBIN=$XDG_DATA_HOME/go/bin

###########################################
###### Postgres Config ####################
export PSQLRC=$XDG_CONFIG_HOME/pg/psqlrc
export PSPG_CONF=$XDG_CONFIG_HOME/pg/pspg.conf
export PGPASSFILE=$XDG_CONFIG_HOME/pg/pgpass
export PSQL_HISTORY=$XDG_STATE_HOME/pg/psql_hst
export PSPG_HISTORY=$XDG_STATE_HOME/pg/pspq_hst

###########################################
###### AWS Config #########################
export AWS_SHARED_CREDENTIALS_FILE=$XDG_CONFIG_HOME/aws/credentials
export AWS_CONFIG_FILE=$XDG_CONFIG_HOME/aws/config

###########################################
###### MySQL Config #######################
export MYSQL_HISTFILE=$XDG_DATA_HOME/mysql_hst

###########################################
###### Redis Config #####################
export REDISCLI_HISTFILE=$XDG_DATA_HOME/redis/rediscli_hst
export REDISCLI_RCFILE=$XDG_CONFIG_HOME/redis/redisclirc

###########################################
###### Ripgrep Config #####################
export RIPGREP_CONFIG_PATH=$XDG_CONFIG_HOME/ripgrep/config

###########################################
###### Terminfo Config ####################
export TERMINFO=$XDG_DATA_HOME/terminfo
export TERMINFO_DIRS="$XDG_DATA_HOME/terminfo:/usr/share/terminfo"

###########################################
###### TeX Config #########################
export TEXMFHOME=$XDG_DATA_HOME/texmf
export TEXMFVAR=$XDG_CACHE_HOME/texlive/texmf-var
export TEXMFCONFIG=$XDG_CONFIG_HOME/texlive/texmf-config

###########################################
###### Spelling Config ####################
export ASPELL_CONF="per-conf $XDG_CONFIG_HOME/aspell/aspell.conf; personal $XDG_CONFIG_HOME/aspell/en.pws; repl $XDG_CONFIG_HOME/aspell/en.prepl"
export ENCHANT_CONFIG_DIR=$XDG_CONFIG_HOME/enchant
export DICPATH=$HOME/Library/Spelling/en_US-custom

###########################################
###### Wget Config ########################
export WGETRC=$XDG_CONFIG_HOME/wgetrc

###########################################
###### Ghostty Config #####################
if [[ -n $GHOSTTY_RESOURCES_DIR ]]; then
    source "$GHOSTTY_RESOURCES_DIR/shell-integration/zsh/ghostty-shell-integration"
fi

###########################################
###### Claude Config ######################
export CLAUDE_CONFIG_DIR=$XDG_CONFIG_HOME/claude
export CLAUDE_CODE_DISABLE_EXPERIMENTAL_BETAS=1
export CLAUDE_BASH_MAINTAIN_PROJECT_WORKING_DIR=1
# export DISABLE_NON_ESSENTIAL_MODEL_CALLS 1
export CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC=1

###########################################
###### User Scripts Config ################
path=(
    $HOME/.local/bin
    $XDG_CONFIG_HOME/bin
    $path
)
export PATH

###########################################
###### Prompt Config ######################
export STARSHIP_CONFIG=$XDG_CONFIG_HOME/starship.toml
export STARSHIP_CACHE=$XDG_CACHE_HOME/starship

###########################################
###### ZSH Config #########################
export HISTFILE=$XDG_STATE_HOME/zsh_hst # create this file
export ZDOTDIR=$XDG_CONFIG_HOME/zsh
